C51 COMPILER V9.60.0.0   MAIN                                                              01/15/2020 23:22:56 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\main.OBJ
COMPILER INVOKED BY: Z:\home\vyldram\SimplicityStudio_v4\developer\toolchains\keil_8051\9.60\BIN\C51.exe /home/vyldram/G
                    -it/C8051C340/C8051C340_ADC_Polling/main.c OMF2 COMPACT DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3) OPTIM
                    -IZE(8,SPEED) INTVECTOR(0X0000) INTPROMOTE INCDIR(/home/vyldram/Git/C8051C340/C8051C340_ADC_Polling/external_copied_files
                    -) REGFILE(C8051C340_ADC_Polling.ORC) NOAREGS PRINT(.\main.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\main.OBJ)

line level    source

   1          /*
   2           * main.c
   3           *
   4           *  Created on: 13/01/2020
   5           *      Author: vyldram
   6           */
   7          
   8          #include <SiLABS\c8051F340.h>
   9          #include <si_toolchain.h>
  10          #include <INTRINS.H>
  11          
  12          
  13          sbit SW1  =  P2^0;                     // SW1 ='0' means switch pressed
  14          sbit SW2  =  P2^1;                     // SW2 ='0' means switch pressed
  15          sbit LED1 =  P2^2;                     // LED1 ='1' means ON
  16          sbit LED2 =  P2^3;                     // LED2 ='1' means ON
  17          
  18          void OSCILLATOR_Init (void);
  19          void PORT_Init (void);
  20          void ADC0_Init(void);
  21          unsigned short ADC0_Sample(void);
  22          bdata unsigned char  variable1[16];
  23          
  24          sbit var10= variable1[0]^0;
  25          data unsigned char  variable2[50];
  26          idata unsigned char  variable3[90];
  27          pdata unsigned char  variable4[200];
  28          
  29          void main (void)
  30          {
  31   1         PCA0MD &= ~0x40;                    // WDTE = 0 (clear watchdog timer
  32   1                                             // enable)
  33   1      
  34   1         PORT_Init();                        // Initialize Port I/O
  35   1         OSCILLATOR_Init ();                 // Initialize Oscillator
  36   1         ADC0_Init();
  37   1      
  38   1         while (1)
  39   1         {
  40   2            if ((unsigned short)ADC0_Sample() < 0x300)                    // If switch depressed
  41   2            {
  42   3               LED1 = 1;                     // Turn on LED
  43   3               var10=0;
  44   3      
  45   3            }
  46   2                else
  47   2            {
  48   3               LED1 = 0;                     // Else, turn it off
  49   3               var10=1;
  50   3            }
  51   2      
  52   2            if (SW2 == 0)                    // If switch depressed
  53   2            {
C51 COMPILER V9.60.0.0   MAIN                                                              01/15/2020 23:22:56 PAGE 2   

  54   3               LED2 = 1;                     // Turn on LED
  55   3            }
  56   2                else
  57   2            {
  58   3               LED2 = 0;                     // Else, turn it off
  59   3            }
  60   2         }                                   // end of while(1)
  61   1      }
  62          
  63          
  64          void ADC0_Init(void)
  65          {
  66   1              P3MDIN&=~0x1; //3.0 as analog input
  67   1              P3SKIP|=0x1;  //skip 3.0 crossbar
  68   1              AMX0P = 0x06; //3.0
  69   1              AMX0N = 0x1F; //GND
  70   1              ADC0CF=0xB8; //maximum sample time and right-jistified
  71   1              ADC0CN= 0xC0;
  72   1      }
  73          
  74          unsigned short ADC0_Sample(void)
  75          {
  76   1              unsigned short u16Value =0x400;
  77   1              ADC0CN|=0x10;
  78   1              while((ADC0CN & 0x10));
  79   1              u16Value=ADC0H<<8;
  80   1              u16Value|=ADC0L;
  81   1      
  82   1              return u16Value;
  83   1      }
  84          
  85          void OSCILLATOR_Init (void)
  86          {
  87   1              unsigned short i=0;
  88   1              OSCICN |= 0x03;                     // Configure internal oscillator for
  89   1                                             // its maximum frequency (24 Mhz)
  90   1              CLKMUL =0;
  91   1              CLKMUL |= 0x80;
  92   1              for (i=0; i<50000; i++);
  93   1              CLKMUL|=0xC0;
  94   1              while((CLKMUL & 0x20) == 0);
  95   1      
  96   1              CLKSEL&=~0x7;
  97   1              CLKSEL|=3;
  98   1      }
  99          
 100          void PORT_Init (void)
 101          {
 102   1         P2MDIN |= 0x0F;                     // Lower four pins on P2 are digital
 103   1      
 104   1         P2MDOUT = 0x0C;                     // enable LEDs as push-pull outputs
 105   1                                             // enable Switches as open-drain
 106   1      
 107   1         P0MDOUT |=0x1;
 108   1         P0MDIN |=0x1;
 109   1      
 110   1      
 111   1         P2     |= 0x03;                     // Set port latches for P2.0
 112   1                                             // and P2.1 to '1'
 113   1      
 114   1         XBR1    = 0x40;                     // Enable crossbar and enable
 115   1                                             // weak pull-ups
 116   1      
C51 COMPILER V9.60.0.0   MAIN                                                              01/15/2020 23:22:56 PAGE 3   

 117   1         XBR0         |=0x8;
 118   1      }
 119          
 120          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    173    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =    200       2
   DATA SIZE        =     66    ----
   IDATA SIZE       =     90    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
